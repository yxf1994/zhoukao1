var fs = require('fs');

exports.Angu={
    create:function(appName){
          this.app=appName;
          var self=this;
         fs.mkdir(appName,function(e){         
            if(e){
                console.log("'"+self.app+"' is exists");
                return;
            }
            else{

                fs.mkdir(self.app+'/app',function(e){
                    if(e) console.log("error in app creation");
                    var appdir=self.app+'/app/';
                    fs.open(self.app+'/package.json','w','0666',function(err,fd){
                     
                    });
                    fs.open(self.app+'/bower.json','w','0666',function(err,fd){

                    });


                    fs.open(appdir+'app.js','w','0666',function(err,fd){

                    });
                    fs.open(appdir+'index.html','w','0666',function(err,fd){
                         if (err) {
                                    throw 'error opening file: ' + err;
                                }
                        var content="<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<meta charset=\"utf-8\">\n\t</head>\n\t<body>\n\t</body>\n</html>";
                       var buffer = new Buffer(content);
                        fs.write(fd, buffer, 0, buffer.length, null, function(err) {
                                    if (err) throw 'error writing file: ' + err;
                                    fs.close(fd, function() {
                                       // console.log('file written');
                                    })
                                });


                    });
                    fs.mkdir(appdir+'directives',function(e){
                        fs.open(appdir+'directives/mainDirective.js','w','0666',function(err,fd){});
                    });
                    fs.mkdir(appdir+'controllers',function(e){
                        fs.open(appdir+'controllers/mainController.js','w','0666',function(err,fd){});
                    });
                    fs.mkdir(appdir+'services',function(e){
                        fs.open(appdir+'services/mainService.js','w','0666',function(err,fd){});
                    });

                });

                fs.mkdir(appName+'/assets',function(e){
                    if(e) console.log("error in assets creation");
                    var assetsDir=appName+'/assets/';
                     fs.mkdir(assetsDir+'js',function(e){
                         fs.open(assetsDir+'js/js.js','w','0666',function(err,fd){});
                     });
                    fs.mkdir(assetsDir+'css',function(e){
                        fs.open(assetsDir+'css/style.css','w','0666',function(err,fd){});
                    });
                    fs.mkdir(assetsDir+'images',function(e){});


                });

            }

        });
        
    },
    generate:function(i,w){
             
                                switch(i){
                                        case 'd':
                                            console.log('generating directive...');
                                            openFile('./app/directives/'+w+'Directive.js','d');
                                        break;
                                        case 'c':
                                            console.log('generating controller...');
                                            openFile('./app/controllers/'+w+'Controller.js','c');
                                        break;
                                        case 's':
                                            console.log('generating service...');
                                            openFile('./app/services/'+w+'Services.js','s');
                                        break;
                                        default:
                                            console.log('Invalid instance');
                                        break;
                                }
       
        
    }
};


function openFile(w,c){
    fs.exists(w, function( exists ) {  
        if(exists){
            console.log( "File is already exists");
            return;
        }
        else{
            fs.open(w,'w','0666',function(err,fd){
                         if (err) {
                                    console.log('You are not inside angular app');
                             return;
                                }

                       var buffer = new Buffer(c);
                        fs.write(fd, buffer, 0, buffer.length, null, function(err) {
                                    if (err) throw 'error writing file: ' + err;
                                    fs.close(fd, function() {
                                       // console.log('file written');
                                    })
                                });


                    });
            
        }
           
});
     return;
}

